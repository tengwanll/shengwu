{% extends 'MirrorAdmBundle:Base:base.html.twig' %}
{% block javascript %}
    <script src="{{ asset('/bundles/mirroradm/js/order.js') }}"></script>
{% endblock %}
{% block typeForm %}
    <form class="form-horizontal" role="form">
        <div class="form-group col-md-8">
            <!-- /.row -->
            <div class="row margin_top">
                <label for="number" class="col-md-1 control-label">编号：</label>
                <div class="col-md-2">
                    <input type="text" class="form-control" id="number">
                </div>
                <label for="status" class="col-md-1 control-label">状态：</label>
                <div class="col-md-2">
                    <select class="form-control messageType" id="status">
                        <option value="all">全部</option>
                        <option value="0">待审核</option>
                        <option value="1">代发货</option>
                        <option value="2">已发货</option>
                        <option value="3">已完成</option>
                        <option value="-1">未通过</option>
                    </select>
                </div>
                <label for="username" class="col-md-1 control-label addressLabel">用户名：</label>
                <div class="col-md-2">
                    <input type="text" class="form-control" id="username">
                </div>
                <div style="clear:both"></div>
                <label for="beginTime" class="col-md-2 control-label addressLabel">起始时间：</label>
                <div class="col-md-2">
                    <input type="text" class="form-control" id="beginTime">
                </div>
                <label for="endTime" class="col-md-2 control-label addressLabel">结束时间：</label>
                <div class="col-md-2">
                    <input type="text" class="form-control" id="endTime">
                </div>

            </div>
            <!-- /.row -->

        </div>
        <div class="form-group col-md-3">
            <div class="row">
                <div class="col-md-3 col-md-offset-9">
                    <button type="reset" class="btn btn-default resetButton">重置</button>
                </div>
            </div>
            <!-- /.row -->
            <div class="row">
                <div class="col-md-3 col-md-offset-9 margin_top">
                    <button id="search" class="btn btn-default resetButton">搜索</button>
                </div>
            </div>
            <!-- /.row -->

        </div>
    </form>
{% endblock %}
{% block thead %}
    <tr class="tableTit">
        <td>订单编号</td>
        <td>下单时间</td>
        <td>下单人</td>
        <td>价格</td>
        <td>订单状态</td>
        <td colspan="3" width="18%">操作</td>
    </tr>
{% endblock %}
 {% block tbody %}
     {#表格内容区#}
 {% endblock %}
 {% block page %}
     <div class="row">
         <div class="col-md-11 col-md-offset-1">
             <p class="listInfo">显示第 1-10项结果，共 10 项</p>
         </div>
         <!-- /.col-md-5 col-md-offset-1 -->
         <div class="col-md-6 col-md-offset-3 text-center">
             <div class="page_list">
                 <ul id="pagination">
                     <span class="prev_page">上一页</span><li class="on">1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><span class="next_page">下一页</span>
                 </ul>
             </div>
         </div>
         <!-- /.col-md-6 col-md-offset-3 -->
     </div>
     <!-- /.row -->
 {% endblock %}
{% block otherJs %}
    <script>
        $(function(){
            adminTabNav($('.adminLeftNav .order'));
        });
        function orderList(object){
            var info={rows:20,page:1};
            if(object != undefined){
                info=$.extend(info,object);
            }
            ajaxAction("get",'/api/order'+ passParam(info),"",false,function(data,textStatus){
                var count=Math.ceil(data.total/20);
                var htmlTab="";
                if(!count){
                    $('tbody').html(htmlTab);
                    return;
                }
                $.jqPaginator('#pagination', {
                    totalPages: count,
                    visiblePages: 6,
                    currentPage: 1,
                    activeClass: 'on',
                    prev: '<span class="prev_page">上一页</span>',
                    next: '<span class="next_page">下一页</span>',
                    page: '<li>{{page}}</li>',
                    onPageChange: function (num, type) {
                        info.page=num;
                        ajaxAction("get",'/api/order'+ passParam(info),"",true,function(data,textStatus){
                            htmlTab = '';
                            var role={{ role }};
                            $.each(data.list,function(index,value){
                                if(value.status=='-1'){
                                    value.status='未通过';
                                }else if(value.status=='0'){
                                    value.status='无效订单';
                                }else if(value.status=='1'){
                                    value.status='待审核';
                                }else if(value.status=='2'){
                                    value.status='订购中';
                                }else if(value.status=='3'){
                                    value.status='已到货';
                                }else if(value.status=='4'){
                                    value.status='已反馈';
                                }
                                if(role>1){
                                    htmlTab+='<tr><td>'+value.number+'</td><td>'+value.createTime+'</td><td>'+value.username+'</td><td>'+value.price+'</td><td id="status">'+value.status+'</td><td><a href="/adm/order/'+value.id+'" class="infoColor">查看详情</a><select name="" id="changeStatus" onchange="changeStatus(this,'+value.id+')"><option value="1">初始</option><option value="2">通过</option><option value="3">到货</option><option value="-1">驳回</option></select></td>';
                                }else{
                                    htmlTab+='<tr><td>'+value.number+'</td><td>'+value.createTime+'</td><td>'+value.username+'</td><td>'+value.price+'</td><td>'+value.status+'</td><td><a href="/adm/order/'+value.id+'" class="infoColor">查看详情</a></td>';
                                }
                            });
                            $('tbody').html(htmlTab);
                        },function(errno,errmsg){
                            alert(errmsg);
                        });

                    }
                });


            },function(errno,errmsg){
                alert(errmsg);
            });

        }
    </script>

{% endblock %}